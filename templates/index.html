{% for z in zlecenia %}
<div class="bg-white p-4 mb-4 rounded shadow">
  <h2 class="text-xl font-bold">{{ z.numer_glowny }} – {{ z.klient }}</h2>
  <p>{{ z.opis }}</p>
  <p><strong>Papier:</strong> {{ z.papier | join(', ') }}</p>
  <p><strong>Uwagi:</strong> {{ z.uwagi }}</p>

  <form method="POST" action="/update/{{ z.id }}">
    <div class="grid grid-cols-2 gap-2 mt-2">
      {% for etap in z.etapy_niezbedne %}
        <label class="flex items-center">
          <input type="checkbox" name="wykonane_etapy" value="{{ etap }}" {% if etap in z.wykonane_etapy %}checked{% endif %}>
          <span class="ml-2">{{ etap }}</span>
          {% if z.historia_etapow[etap] %}
            <span class="text-xs text-gray-500 ml-4">({{ z.historia_etapow[etap][:16] }})</span>
          {% endif %}
        </label>
      {% endfor %}
    </div>
    <button class="bg-blue-500 text-white px-3 py-1 mt-2 rounded">✔ Zapisz etapy</button>
  </form>

  {% if not z.zakonczone and z.etapy_niezbedne|length == z.wykonane_etapy|length %}
    <form method="POST" action="/zakoncz/{{ z.id }}" class="mt-2">
      <button class="bg-green-700 text-white px-3 py-2 rounded">✅ Zakończ zlecenie</button>
    </form>
  {% endif %}

  {% if not z.zatrzymano %}
  <form method="POST" action="/zatrzymaj/{{ z.id }}" class="mt-4">
    <textarea name="powod" placeholder="Powód zatrzymania" class="w-full mb-2 border px-2 py-1 rounded"></textarea>
    <button class="bg-red-600 text-white px-3 py-1 rounded">⛔ Zatrzymaj</button>
  </form>
  {% else %}
    <p class="text-red-600 mt-2">⛔ Zatrzymano: {{ z.powod_zatrzymania }}</p>
  {% endif %}
</div>
{% endfor %}
